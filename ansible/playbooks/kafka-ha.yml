---
# Развернуть Apache Kafka HA кластер (KRaft, 3+ нод, без ZooKeeper)
#
# Предварительно задать в group_vars/kafka_ha.yml:
#   kafka_cluster_id: "<UUID из kafka-storage.sh random-uuid>"
#   kafka_controller_quorum_voters: "1@10.0.0.1:9093,2@10.0.0.2:9093,3@10.0.0.3:9093"
#
# И в host_vars/<hostname>.yml для каждой ноды:
#   kafka_node_id: 1    # уникальный int, разный для каждой ноды
#
# Использование:
#   # Без аутентификации:
#   ansible-playbook playbooks/kafka-ha.yml -i inventories/production/hosts.yml -l kafka_ha
#
#   # SASL/SCRAM:
#   ansible-playbook playbooks/kafka-ha.yml -i inventories/production/hosts.yml -l kafka_ha \
#     -e "kafka_security_protocol=SASL_PLAINTEXT" \
#     -e "kafka_broker_password=BrokerPass123" \
#     --ask-vault-pass
#
#   # SASL/SCRAM + TLS:
#   ansible-playbook playbooks/kafka-ha.yml -i inventories/production/hosts.yml -l kafka_ha \
#     -e "kafka_security_protocol=SASL_SSL" \
#     -e "kafka_ssl_keystore_src=files/kafka.keystore.jks" \
#     -e "kafka_ssl_truststore_src=files/kafka.truststore.jks" \
#     --ask-vault-pass

- name: Deploy Apache Kafka HA cluster (KRaft)
  hosts: kafka_ha
  become: true
  gather_facts: true

  roles:
    - role: kafka_ha
